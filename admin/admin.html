<!doctype html>
<html lang="vi" data-theme="auto">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VNR Admin ‚Äì Prototype UI</title>
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Tabler Icons -->
  <link href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@latest/tabler-icons.min.css" rel="stylesheet" />
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    :root { --sidebar-w: 260px; --radius: 14px; }
    [data-theme="dark"] body { background:#0b0e12; }
    body { background:#f8f9fb; }

    /* Sidebar */
    .sidebar {
      position: fixed; inset:0 auto 0 0; width:var(--sidebar-w);
      background:#0d6efd; color:#fff; padding:14px 10px; overflow-y:auto; z-index:1040;
      transition: width .2s ease;
    }
    .sidebar .brand { padding: 10px 12px; font-weight:700; font-size:1.1rem; }
    .sidebar a { color:#e7f1ff; text-decoration:none; display:flex; gap:10px; align-items:center;
      padding:9px 12px; border-radius:10px; }
    .sidebar a:hover, .sidebar a.active { background:#0b5ed7; color:#fff; }
    .sidebar .section-hint{ color:#d0e4ff; opacity:.8; }

    /* Content */
    .content { margin-left:var(--sidebar-w); min-height:100vh; transition: margin-left .2s ease; }
    .topbar { position:sticky; top:0; z-index:20; background:#fff; border-bottom:1px solid #e9ecef; }
    [data-theme="dark"] .topbar { background:#0f1218; border-color:#1a2030; }

    .card { border-radius: var(--radius); }
    .section { display:none; }
    .section.active { display:block; }
    .table thead th { white-space:nowrap; }

    /* Compact mode (collapse sidebar) */
    .sidebar.collapsed { width:72px; }
    .sidebar.collapsed .brand span, .sidebar.collapsed nav a span, .sidebar.collapsed .section-hint { display:none; }
    .content.collapsed { margin-left:72px; }

    /* Skeleton */
    .skeleton { background:linear-gradient(90deg,#eee 25%,#f5f5f5 37%,#eee 63%); background-size:400% 100%; animation:s 1.2s ease infinite; border-radius:8px; }
    @keyframes s { 0%{background-position:100% 50%} 100%{background-position:0 50%} }

    /* Badges */
    .badge-soft {
      border:1px solid transparent; background:#f3f6ff; color:#2f5aff;
    }
    [data-theme="dark"] .badge-soft { background:#101826; color:#7aa2ff; border-color:#1a2541; }

    /* Footer hint */
    .muted { color:#93a0b5; font-size:12px; }

    /* Search in section */
    .section-search { max-width: 380px; }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="d-flex align-items-center justify-content-between px-2">
      <div class="brand d-flex align-items-center gap-2">
        <i class="ti ti-train"></i> <span>VNR Admin</span>
      </div>
      <button class="btn btn-sm btn-light d-none d-lg-inline-flex" id="btnCollapse" title="Thu g·ªçn">
        <i class="ti ti-layout-sidebar-left-collapse"></i>
      </button>
    </div>

    <div class="mt-2 section-hint small px-2">ƒêi·ªÅu h∆∞·ªõng</div>
    <nav class="mt-1" id="nav">
      <a href="#dashboard" class="active"><i class="ti ti-layout-dashboard"></i><span>Dashboard</span></a>

      <div class="section-hint small px-2 mt-3 mb-1">Chuy·∫øn t√†u</div>
      <a href="#stations"><i class="ti ti-map-pin"></i><span>Ga</span></a>
      <a href="#trains"><i class="ti ti-train"></i><span>T√†u</span></a>
      <a href="#schedules"><i class="ti ti-calendar-time"></i><span>L·ªãch tr√¨nh</span></a>

      <div class="section-hint small px-2 mt-3 mb-1">N·ªôi dung</div>
      <a href="#menus"><i class="ti ti-list-details"></i><span>Menu website</span></a>

      <div class="section-hint small px-2 mt-3 mb-1">Kinh doanh</div>
      <a href="#bookings"><i class="ti ti-ticket"></i><span>ƒê·∫∑t v√©</span></a>
      <a href="#reports"><i class="ti ti-chart-line"></i><span>B√°o c√°o</span></a>

      <div class="section-hint small px-2 mt-3 mb-1">Kh√°c</div>
      <a href="#settings"><i class="ti ti-settings"></i><span>C√†i ƒë·∫∑t</span></a>
    </nav>
  </aside>

  <!-- Content -->
  <div class="content" id="content">
    <!-- Topbar -->
    <div class="topbar">
      <div class="container-fluid py-2 px-3 d-flex align-items-center justify-content-between">
        <div class="d-flex align-items-center gap-2">
          <button class="btn btn-sm btn-outline-secondary d-lg-none me-1" id="btnSidebar"><i class="ti ti-menu-2"></i></button>
          <span class="fw-semibold" id="pageTitle">B·∫£ng ƒëi·ªÅu khi·ªÉn</span>
          <span class="text-muted" id="breadcrumb">/ Dashboard</span>
        </div>
        <div class="d-flex align-items-center gap-2">
          <div class="input-group input-group-sm section-search d-none d-md-flex">
            <span class="input-group-text bg-white"><i class="ti ti-search"></i></span>
            <input type="search" class="form-control" id="sectionSearch" placeholder="T√¨m nhanh trong m·ª•c ƒëang xem‚Ä¶" />
          </div>
          <button class="btn btn-sm btn-outline-secondary" id="btnTheme" title="Ch·∫ø ƒë·ªô s√°ng/t·ªëi"><i class="ti ti-sun-moon"></i></button>
          <div class="dropdown">
            <button class="btn btn-sm btn-primary dropdown-toggle" data-bs-toggle="dropdown"><i class="ti ti-user"></i> admin</button>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><h6 class="dropdown-header">T√†i kho·∫£n</h6></li>
              <li><a class="dropdown-item" href="#settings">C√†i ƒë·∫∑t</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item" href="logout.php">ƒêƒÉng xu·∫•t</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <main class="container-fluid p-3 p-md-4">

      <!-- DASHBOARD -->
      <section id="dashboard" class="section active" data-title="Dashboard">
        <div class="row g-3">
          <div class="col-sm-6 col-xl-3"><div class="card shadow-sm"><div class="card-body">
            <div class="text-muted small">T·ªïng ga</div><div class="display-6" id="statStations">‚Äî</div>
          </div></div></div>
          <div class="col-sm-6 col-xl-3"><div class="card shadow-sm"><div class="card-body">
            <div class="text-muted small">T·ªïng t√†u</div><div class="display-6" id="statTrains">‚Äî</div>
          </div></div></div>
          <div class="col-sm-6 col-xl-3"><div class="card shadow-sm"><div class="card-body">
            <div class="text-muted small">L·ªãch tr√¨nh</div><div class="display-6" id="statSchedules">‚Äî</div>
          </div></div></div>
          <div class="col-sm-6 col-xl-3"><div class="card shadow-sm"><div class="card-body">
            <div class="text-muted small">Doanh thu (ƒë√£ thanh to√°n)</div><div class="display-6" id="statRevenue">‚Äî</div>
          </div></div></div>
        </div>

        <div class="card mt-4 shadow-sm">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h5 class="mb-0">ƒê∆°n g·∫ßn ƒë√¢y</h5>
              <button class="btn btn-sm btn-outline-primary" data-open="#bookings">Xem t·∫•t c·∫£</button>
            </div>
            <div class="table-responsive">
              <table class="table align-middle table-striped" id="recentOrders">
                <thead><tr><th>M√£</th><th>Kh√°ch h√†ng</th><th>Kh·ªüi h√†nh</th><th>Tr·∫°ng th√°i</th><th>T·ªïng</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="card mt-4 shadow-sm">
          <div class="card-body">
            <h5 class="mb-3">Doanh thu theo ng√†y</h5>
            <canvas id="chartRevenue" height="110"></canvas>
          </div>
        </div>
      </section>

      <!-- STATIONS -->
      <section id="stations" class="section" data-title="Qu·∫£n l√Ω Ga">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3 class="mb-0">Qu·∫£n l√Ω Ga</h3>
          <div class="d-flex gap-2">
            <input class="form-control form-control-sm" id="filterStations" placeholder="T√¨m ga‚Ä¶" />
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalStation">+ Th√™m ga</button>
          </div>
        </div>
        <div class="card shadow-sm"><div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped align-middle" id="tblStations">
              <thead><tr><th>#</th><th>M√£</th><th>T√™n</th><th>T·ªânh/TP</th><th style="width:160px">Thao t√°c</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
          <div class="d-flex justify-content-between align-items-center mt-2">
            <div class="muted" id="stationsInfo">‚Äî</div>
            <nav><ul class="pagination pagination-sm mb-0" id="stationsPager"></ul></nav>
          </div>
        </div></div>
      </section>

      <!-- TRAINS -->
      <section id="trains" class="section" data-title="Qu·∫£n l√Ω T√†u">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3 class="mb-0">Qu·∫£n l√Ω T√†u</h3>
          <div class="d-flex gap-2">
            <input class="form-control form-control-sm" id="filterTrains" placeholder="T√¨m t√†u‚Ä¶" />
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalTrain">+ Th√™m t√†u</button>
          </div>
        </div>
        <div class="card shadow-sm"><div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped align-middle" id="tblTrains">
              <thead><tr><th>#</th><th>M√£ t√†u</th><th>T√™n t√†u</th><th>S·ª©c ch·ª©a</th><th style="width:160px">Thao t√°c</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
          <div class="d-flex justify-content-between align-items-center mt-2">
            <div class="muted" id="trainsInfo">‚Äî</div>
            <nav><ul class="pagination pagination-sm mb-0" id="trainsPager"></ul></nav>
          </div>
        </div></div>
      </section>

      <!-- SCHEDULES -->
      <section id="schedules" class="section" data-title="Qu·∫£n l√Ω L·ªãch tr√¨nh">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3 class="mb-0">Qu·∫£n l√Ω L·ªãch tr√¨nh</h3>
          <div class="d-flex gap-2">
            <input class="form-control form-control-sm" id="filterSchedules" placeholder="T√¨m l·ªãch tr√¨nh‚Ä¶" />
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalSchedule">+ Th√™m l·ªãch tr√¨nh</button>
          </div>
        </div>
        <div class="card shadow-sm"><div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped align-middle" id="tblSchedules">
              <thead><tr><th>#</th><th>T√†u</th><th>Ga ƒëi</th><th>Ga ƒë·∫øn</th><th>Kh·ªüi h√†nh</th><th>ƒê·∫øn n∆°i</th><th>Gi√° v√©</th><th style="width:180px">Thao t√°c</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
          <div class="d-flex justify-content-between align-items-center mt-2">
            <div class="muted" id="schedulesInfo">‚Äî</div>
            <nav><ul class="pagination pagination-sm mb-0" id="schedulesPager"></ul></nav>
          </div>
        </div></div>
      </section>

      <!-- MENUS -->
      <section id="menus" class="section" data-title="Qu·∫£n l√Ω Menu Website">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3 class="mb-0">Qu·∫£n l√Ω Menu Website</h3>
          <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalMenu">+ Th√™m menu</button>
        </div>
        <div class="card shadow-sm"><div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped align-middle" id="tblMenus">
              <thead><tr><th>#</th><th>V·ªã tr√≠</th><th>Nh√£n</th><th>URL</th><th>Th·ª© t·ª±</th><th>Hi·ªÉn th·ªã</th><th style="width:160px">Thao t√°c</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div></div>
      </section>

      <!-- BOOKINGS -->
      <section id="bookings" class="section" data-title="ƒê∆°n ƒë·∫∑t v√©">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3 class="mb-0">ƒê∆°n ƒë·∫∑t v√©</h3>
          <div class="d-flex gap-2">
            <input class="form-control form-control-sm" id="filterBookings" placeholder="T√¨m ƒë∆°n‚Ä¶" />
            <button class="btn btn-outline-secondary btn-sm" id="btnExport"><i class="ti ti-download"></i> Xu·∫•t CSV</button>
          </div>
        </div>
        <div class="card shadow-sm"><div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped align-middle" id="tblBookings">
              <thead><tr><th>M√£</th><th>Kh√°ch</th><th>Tuy·∫øn</th><th>Kh·ªüi h√†nh</th><th>S·ªë v√©</th><th>T·ªïng</th><th>Tr·∫°ng th√°i</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div></div>
      </section>

      <!-- REPORTS -->
      <section id="reports" class="section" data-title="B√°o c√°o & Th·ªëng k√™">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3 class="mb-0">B√°o c√°o & Th·ªëng k√™</h3>
          <form class="d-flex gap-2">
            <input type="date" class="form-control" id="fromDate" />
            <input type="date" class="form-control" id="toDate" />
            <button class="btn btn-primary" id="btnFilter" type="button">L·ªçc</button>
          </form>
        </div>
        <div class="row g-3">
          <div class="col-md-3"><div class="card shadow-sm"><div class="card-body"><div class="text-muted small">Doanh thu (paid)</div><div class="display-6" id="rpRevenue">‚Äî</div></div></div></div>
          <div class="col-md-3"><div class="card shadow-sm"><div class="card-body"><div class="text-muted small">ƒê∆°n</div><div class="display-6" id="rpOrders">‚Äî</div></div></div></div>
          <div class="col-md-3"><div class="card shadow-sm"><div class="card-body"><div class="text-muted small">ƒê∆°n ƒë√£ thanh to√°n</div><div class="display-6" id="rpPaid">‚Äî</div></div></div></div>
          <div class="col-md-3"><div class="card shadow-sm"><div class="card-body"><div class="text-muted small">ƒê∆°n h·ªßy</div><div class="display-6" id="rpCanceled">‚Äî</div></div></div></div>
        </div>
        <div class="card mt-4 shadow-sm"><div class="card-body">
          <h5 class="mb-3">Bi·ªÉu ƒë·ªì doanh thu</h5>
          <canvas id="chartReport" height="110"></canvas>
        </div></div>
      </section>

      <!-- SETTINGS -->
      <section id="settings" class="section" data-title="C√†i ƒë·∫∑t">
        <h3 class="mb-3">C√†i ƒë·∫∑t</h3>
        <div class="card shadow-sm"><div class="card-body">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">T√™n website</label>
              <input class="form-control" value="ƒê∆∞·ªùng S·∫Øt Vi·ªát Nam ‚Äì Demo" />
            </div>
            <div class="col-md-6">
              <label class="form-label">Email li√™n h·ªá</label>
              <input class="form-control" value="support@example.com" />
            </div>
          </div>
          <button class="btn btn-success mt-3" id="btnSaveSettings">L∆∞u</button>
        </div></div>
        <div class="muted mt-2">Prototype UI ‚Äì khi n·ªëi backend, c√°c n√∫t s·∫Ω g·ªçi API t∆∞∆°ng ·ª©ng.</div>
      </section>
    </main>
  </div>

  <!-- MODALS -->
  <div class="modal fade" id="modalStation" tabindex="-1">
    <div class="modal-dialog"><div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">Th√™m/C·∫≠p nh·∫≠t Ga</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
        <div class="row g-2">
          <div class="col-4"><label class="form-label">M√£</label><input id="stCode" class="form-control" required></div>
          <div class="col-8"><label class="form-label">T√™n ga</label><input id="stName" class="form-control" required></div>
          <div class="col-12"><label class="form-label">T·ªânh/TP</label><input id="stCity" class="form-control" required></div>
        </div>
      </div>
      <div class="modal-footer"><button class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button><button class="btn btn-primary" id="saveStation">L∆∞u</button></div>
    </div></div>
  </div>

  <div class="modal fade" id="modalTrain" tabindex="-1">
    <div class="modal-dialog"><div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">Th√™m/C·∫≠p nh·∫≠t T√†u</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
        <div class="row g-2">
          <div class="col-4"><label class="form-label">M√£ t√†u</label><input id="trCode" class="form-control" required></div>
          <div class="col-8"><label class="form-label">T√™n t√†u</label><input id="trName" class="form-control" required></div>
          <div class="col-12"><label class="form-label">S·ª©c ch·ª©a</label><input id="trCap" type="number" class="form-control" value="100" min="1" required></div>
        </div>
      </div>
      <div class="modal-footer"><button class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button><button class="btn btn-primary" id="saveTrain">L∆∞u</button></div>
    </div></div>
  </div>

  <div class="modal fade" id="modalSchedule" tabindex="-1">
    <div class="modal-dialog modal-lg"><div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">Th√™m/C·∫≠p nh·∫≠t L·ªãch tr√¨nh</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
        <div class="row g-2">
          <div class="col-md-4"><label class="form-label">T√†u</label><select id="scTrain" class="form-select" required></select></div>
          <div class="col-md-4"><label class="form-label">Ga ƒëi</label><select id="scDepart" class="form-select" required></select></div>
          <div class="col-md-4"><label class="form-label">Ga ƒë·∫øn</label><select id="scArrive" class="form-select" required></select></div>
          <div class="col-md-6"><label class="form-label">Kh·ªüi h√†nh</label><input id="scStart" type="datetime-local" class="form-control" required></div>
          <div class="col-md-6"><label class="form-label">ƒê·∫øn n∆°i</label><input id="scEnd" type="datetime-local" class="form-control" required></div>
          <div class="col-12"><label class="form-label">Gi√° v√© (ƒë)</label><input id="scPrice" type="number" class="form-control" value="100000" min="0" required></div>
        </div>
      </div>
      <div class="modal-footer"><button class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button><button class="btn btn-primary" id="saveSchedule">L∆∞u</button></div>
    </div></div>
  </div>

  <div class="modal fade" id="modalMenu" tabindex="-1">
    <div class="modal-dialog"><div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">Th√™m/C·∫≠p nh·∫≠t Menu</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
        <div class="row g-2">
          <div class="col-md-4"><label class="form-label">V·ªã tr√≠</label><select id="mnLoc" class="form-select"><option value="header">header</option><option value="footer">footer</option></select></div>
          <div class="col-md-5"><label class="form-label">Nh√£n</label><input id="mnLabel" class="form-control" placeholder="Trang ch·ªß" required></div>
          <div class="col-md-3"><label class="form-label">Th·ª© t·ª±</label><input id="mnPos" type="number" class="form-control" value="0" required></div>
          <div class="col-12"><label class="form-label">URL</label><input id="mnUrl" class="form-control" placeholder="/index.php" required></div>
          <div class="col-12 form-check mt-2"><input id="mnShow" type="checkbox" class="form-check-input" checked><label class="form-check-label" for="mnShow">Hi·ªÉn th·ªã</label></div>
        </div>
      </div>
      <div class="modal-footer"><button class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button><button class="btn btn-primary" id="saveMenu">L∆∞u</button></div>
    </div></div>
  </div>

  <!-- Toasts -->
  <div class="position-fixed bottom-0 end-0 p-3" style="z-index:1080">
    <div id="toast" class="toast align-items-center text-bg-dark border-0" role="alert">
      <div class="d-flex">
        <div class="toast-body" id="toastBody">ƒê√£ l∆∞u</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // ====== MODE: 'demo' d√πng d·ªØ li·ªáu gi·∫£; 'api' g·ªçi backend ======
    const MODE = 'demo'; // ƒë·ªïi sang 'api' khi ƒë√£ c√≥ /admin/api.php

    const API = {
      stations: '/admin/api.php?entity=stations',
      trains:   '/admin/api.php?entity=trains',
      schedules:'/admin/api.php?entity=schedules',
      menus:    '/admin/api.php?entity=menus',
      bookings: '/admin/api.php?entity=bookings',
      reports:  '/admin/api.php?entity=reports',
    };

    // ====== Demo data (in-memory) ======
    const db = {
      stations: [
        {id:1, code:'HN', name:'H√† N·ªôi', city:'H√† N·ªôi'},
        {id:2, code:'HP', name:'H·∫£i Ph√≤ng', city:'H·∫£i Ph√≤ng'},
        {id:3, code:'QN', name:'Qu·∫£ng Ninh', city:'Qu·∫£ng Ninh'},
        {id:4, code:'DN', name:'ƒê√† N·∫µng', city:'ƒê√† N·∫µng'},
        {id:5, code:'NT', name:'Nha Trang', city:'Kh√°nh H√≤a'},
      ],
      trains: [
        {id:1, code:'SE1', name:'B·∫Øc Nam Express 1', seat:400},
        {id:2, code:'SE2', name:'B·∫Øc Nam Express 2', seat:420},
        {id:3, code:'LP5', name:'H·∫£i Ph√≤ng Line', seat:300},
      ],
      schedules: [
        {id:1, train_id:1, depart:1, arrive:2, start:'2025-10-03T08:00', end:'2025-10-03T18:00', price:1200000},
        {id:2, train_id:2, depart:2, arrive:1, start:'2025-10-05T09:00', end:'2025-10-05T19:00', price:1200000},
        {id:3, train_id:3, depart:2, arrive:1, start:'2025-10-07T07:30', end:'2025-10-07T10:00', price:180000},
        {id:4, train_id:1, depart:1, arrive:4, start:'2025-10-09T20:00', end:'2025-10-10T07:30', price:650000},
      ],
      menus: [
        {id:1, location:'header', label:'Trang ch·ªß', url:'/index.php', position:0, visible:true},
        {id:2, location:'header', label:'T√¨m chuy·∫øn t√†u', url:'/tim_kiem.php', position:1, visible:true},
        {id:3, location:'footer', label:'ƒêi·ªÅu kho·∫£n', url:'/terms.php', position:0, visible:true},
      ],
      bookings: [
        {code:'A1B2C3', customer:'Nguy·ªÖn VƒÉn A', line:'H√† N·ªôi ‚Üí TP.HCM', start:'2025-10-12 08:00', qty:2, total:2400000, status:'paid'},
        {code:'D4E5F6', customer:'Tr·∫ßn Th·ªã B', line:'H·∫£i Ph√≤ng ‚Üí H√† N·ªôi', start:'2025-10-13 09:00', qty:1, total:200000, status:'pending'},
        {code:'G7H8I9', customer:'Ph·∫°m C', line:'Qu·∫£ng Ninh ‚Üí H√† N·ªôi', start:'2025-10-14 09:00', qty:3, total:600000, status:'paid'}
      ]
    };

    // ====== Helpers ======
    const $  = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const toast = new bootstrap.Toast($('#toast'));

    function showToast(msg, variant='dark'){
      const t = $('#toast');
      t.className = `toast align-items-center text-bg-${variant} border-0`;
      $('#toastBody').textContent = msg;
      toast.show();
    }
    function fmtMoney(n){ return (n||0).toLocaleString('vi-VN') + ' ƒë'; }
    function setBreadcrumb(text){ $('#breadcrumb').textContent = '/ ' + text; $('#pageTitle').textContent = text; }
    function confirmDelete(){ return confirm('B·∫°n ch·∫Øc ch·∫Øn mu·ªën xo√°?'); }

    // ====== Theme auto + toggle ======
    const mqDark = window.matchMedia('(prefers-color-scheme: dark)');
    const root   = document.documentElement;
    function applyTheme() {
      const pref = localStorage.getItem('theme') || 'auto';
      root.setAttribute('data-theme', pref==='auto' ? (mqDark.matches?'dark':'light') : pref);
    }
    applyTheme(); mqDark.addEventListener('change', applyTheme);
    $('#btnTheme').addEventListener('click', () => {
      const current = localStorage.getItem('theme') || 'auto';
      const next = current==='auto' ? 'dark' : current==='dark' ? 'light' : 'auto';
      localStorage.setItem('theme', next); applyTheme();
      showToast('Ch·∫ø ƒë·ªô: ' + next.toUpperCase(), 'primary');
    });

    // ====== Sidebar collapse ======
    const sidebar = $('#sidebar'), content = $('#content');
    $('#btnCollapse').addEventListener('click', () => {
      sidebar.classList.toggle('collapsed'); content.classList.toggle('collapsed');
    });
    $('#btnSidebar').addEventListener('click', () => {
      sidebar.classList.toggle('d-none');
    });

    // ====== Navigation routing ======
    function showSection(id){
      $$('.section').forEach(s=>s.classList.remove('active'));
      const el = document.getElementById(id) || document.getElementById('dashboard');
      el.classList.add('active');
      $$('#nav a').forEach(a=>a.classList.toggle('active', a.getAttribute('href') === '#'+id));
      setBreadcrumb(el.dataset.title || id);

      if(id==='dashboard'){ renderDashboard(); }
      if(id==='stations'){ renderStations(); }
      if(id==='trains'){ renderTrains(); }
      if(id==='schedules'){ renderSchedules(); }
      if(id==='menus'){ renderMenus(); }
      if(id==='bookings'){ renderBookings(); }
      if(id==='reports'){ renderReports(); }
    }
    window.addEventListener('hashchange', ()=>showSection(location.hash.slice(1)||'dashboard'));
    $('#nav').addEventListener('click', e=>{
      const a = e.target.closest('a[href^="#"]'); if(!a) return;
      e.preventDefault(); const id=a.getAttribute('href').slice(1); history.pushState(null,'','#'+id); showSection(id);
    });
    $$('[data-open]').forEach(btn=>btn.addEventListener('click', ()=> {
      const id = btn.getAttribute('data-open').replace('#','');
      history.pushState(null,'','#'+id); showSection(id);
    }));

    // ====== Section search (filter in-place) ======
    $('#sectionSearch').addEventListener('input', ()=>{
      const q = $('#sectionSearch').value.trim().toLowerCase();
      const active = document.querySelector('.section.active');
      const rows = active?.querySelectorAll('tbody tr')||[];
      rows.forEach(tr=>{
        const hit = tr.innerText.toLowerCase().includes(q);
        tr.style.display = hit ? '' : 'none';
      });
    });

    // ====== Renderers ======
    function renderDashboard(){
      $('#statStations').textContent  = db.stations.length;
      $('#statTrains').textContent    = db.trains.length;
      $('#statSchedules').textContent = db.schedules.length;
      const revenue = db.bookings.filter(b=>b.status==='paid').reduce((s,b)=>s+b.total,0);
      $('#statRevenue').textContent   = fmtMoney(revenue);

      const tb = $('#recentOrders tbody'); tb.innerHTML='';
      const items = db.bookings.slice(-5).reverse();
      if (!items.length) {
        tb.innerHTML = `<tr><td colspan="5" class="text-center text-muted">Ch∆∞a c√≥ ƒë∆°n</td></tr>`;
      } else {
        items.forEach(b=>{
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td><code>${b.code}</code></td>
            <td>${b.customer}</td>
            <td>${b.start}</td>
            <td><span class="badge ${b.status==='paid'?'bg-success':(b.status==='pending'?'bg-warning':'bg-secondary')}">${b.status}</span></td>
            <td>${fmtMoney(b.total)}</td>`;
          tb.appendChild(tr);
        });
      }

      const ctx = document.getElementById('chartRevenue');
      new Chart(ctx,{type:'line', data:{
        labels: Array.from({length:7},(_,i)=>{const d=new Date(); d.setDate(d.getDate()-6+i); return d.toISOString().slice(0,10)}),
        datasets:[{label:'Revenue (demo)', data:Array.from({length:7},()=>Math.round(Math.random()*2_000_000)), tension:.25}]
      }, options:{responsive:true, scales:{y:{beginAtZero:true}}}});
    }

    // Pagination helper
    function paginate(arr, page=1, per=8){ const total=arr.length, pages=Math.max(1,Math.ceil(total/per)); const start=(page-1)*per; return {items:arr.slice(start,start+per), pages, total}; }
    function renderPager(el, pages, page, onGo){
      el.innerHTML=''; for(let i=1;i<=pages;i++){ const li=document.createElement('li'); li.className='page-item'+(i===page?' active':''); li.innerHTML=`<a class="page-link" href="#">${i}</a>`; li.onclick=(e)=>{e.preventDefault(); onGo(i)}; el.appendChild(li); }
    }

    // STATIONS
    function renderStations(page=1){
      const q = ($('#filterStations').value||'').toLowerCase();
      const list = db.stations.filter(s=> (s.name+s.city+s.code).toLowerCase().includes(q));
      const {items, pages, total} = paginate(list, page);
      const tb = $('#tblStations tbody'); tb.innerHTML='';
      if(!items.length){ tb.innerHTML=`<tr><td colspan="5" class="text-center text-muted">Kh√¥ng c√≥ d·ªØ li·ªáu</td></tr>`; }
      items.forEach((s,i)=>{
        const tr=document.createElement('tr');
        tr.innerHTML = `
          <td>${(page-1)*8 + i + 1}</td>
          <td>${s.code}</td>
          <td>${s.name}</td>
          <td>${s.city}</td>
          <td>
            <button class="btn btn-sm btn-outline-primary me-1" data-edit-station="${s.id}">S·ª≠a</button>
            <button class="btn btn-sm btn-outline-danger" data-del-station="${s.id}">Xo√°</button>
          </td>`;
        tb.appendChild(tr);
      });
      $('#stationsInfo').textContent = `Hi·ªÉn th·ªã ${items.length}/${total} b·∫£n ghi`;
      renderPager($('#stationsPager'), pages, page, i=>renderStations(i));
    }
    // event handlers
    $('#filterStations').addEventListener('input', ()=>renderStations(1));
    $('#tblStations').addEventListener('click', (e)=>{
      const btnE = e.target.closest('[data-edit-station]'); const btnD = e.target.closest('[data-del-station]');
      if(btnE){ const id=+btnE.dataset.editStation; const s=db.stations.find(x=>x.id===id); $('#stCode').value=s.code; $('#stName').value=s.name; $('#stCity').value=s.city; $('#saveStation').dataset.id=id; new bootstrap.Modal('#modalStation').show(); }
      if(btnD){ const id=+btnD.dataset.delStation; if(confirmDelete()){ db.stations = db.stations.filter(x=>x.id!==id); renderStations(); showToast('ƒê√£ xo√° ga','danger'); } }
    });
    $('#saveStation').addEventListener('click', ()=>{
      const code=$('#stCode').value.trim(), name=$('#stName').value.trim(), city=$('#stCity').value.trim(); if(!code||!name||!city){ showToast('Vui l√≤ng nh·∫≠p ƒë·ªß th√¥ng tin','warning'); return; }
      const id = +($('#saveStation').dataset.id||0);
      if(id){ Object.assign(db.stations.find(x=>x.id===id),{code,name,city}); showToast('ƒê√£ c·∫≠p nh·∫≠t ga','success'); }
      else { db.stations.push({id:Date.now(), code,name,city}); showToast('ƒê√£ th√™m ga','success'); }
      delete $('#saveStation').dataset.id; bootstrap.Modal.getInstance($('#modalStation')).hide(); renderStations();
    });

    // TRAINS
    function renderTrains(page=1){
      const q = ($('#filterTrains').value||'').toLowerCase();
      const list = db.trains.filter(t=> (t.name+t.code+(t.seat||'')).toLowerCase().includes(q));
      const {items, pages, total} = paginate(list, page);
      const tb=$('#tblTrains tbody'); tb.innerHTML='';
      if(!items.length){ tb.innerHTML=`<tr><td colspan="5" class="text-center text-muted">Kh√¥ng c√≥ d·ªØ li·ªáu</td></tr>`; }
      items.forEach((t,i)=>{
        const tr=document.createElement('tr');
        tr.innerHTML = `
          <td>${(page-1)*8+i+1}</td>
          <td>${t.code}</td><td>${t.name}</td><td>${t.seat}</td>
          <td>
            <button class="btn btn-sm btn-outline-primary me-1" data-edit-train="${t.id}">S·ª≠a</button>
            <button class="btn btn-sm btn-outline-danger" data-del-train="${t.id}">Xo√°</button>
          </td>`;
        tb.appendChild(tr);
      });
      $('#trainsInfo').textContent = `Hi·ªÉn th·ªã ${items.length}/${total} b·∫£n ghi`;
      renderPager($('#trainsPager'), pages, page, i=>renderTrains(i));
    }
    $('#filterTrains').addEventListener('input', ()=>renderTrains(1));
    $('#tblTrains').addEventListener('click', (e)=>{
      const btnE=e.target.closest('[data-edit-train]'); const btnD=e.target.closest('[data-del-train]');
      if(btnE){ const id=+btnE.dataset.editTrain; const t=db.trains.find(x=>x.id===id); $('#trCode').value=t.code; $('#trName').value=t.name; $('#trCap').value=t.seat; $('#saveTrain').dataset.id=id; new bootstrap.Modal('#modalTrain').show(); }
      if(btnD){ const id=+btnD.dataset.delTrain; if(confirmDelete()){ db.trains=db.trains.filter(x=>x.id!==id); renderTrains(); showToast('ƒê√£ xo√° t√†u','danger'); } }
    });
    $('#saveTrain').addEventListener('click', ()=>{
      const code=$('#trCode').value.trim(), name=$('#trName').value.trim(), seat=+$('#trCap').value||0; if(!code||!name||seat<=0){ showToast('Th√¥ng tin kh√¥ng h·ª£p l·ªá','warning'); return; }
      const id=+($('#saveTrain').dataset.id||0);
      if(id){ Object.assign(db.trains.find(x=>x.id===id),{code,name,seat}); showToast('ƒê√£ c·∫≠p nh·∫≠t t√†u','success'); }
      else { db.trains.push({id:Date.now(), code,name,seat}); showToast('ƒê√£ th√™m t√†u','success'); }
      delete $('#saveTrain').dataset.id; bootstrap.Modal.getInstance($('#modalTrain')).hide(); renderTrains();
    });

    // SCHEDULES
    function fillScheduleSelects(){
      const opts = arr => arr.map(v=>`<option value='${v.id}'>${v.name}</option>`).join('');
      $('#scTrain').innerHTML  = opts(db.trains);
      $('#scDepart').innerHTML = opts(db.stations);
      $('#scArrive').innerHTML = opts(db.stations);
    }
    function renderSchedules(page=1){
      fillScheduleSelects();
      const q = ($('#filterSchedules').value||'').toLowerCase();
      const mapTrain = id => db.trains.find(t=>t.id===id)?.name||'';
      const mapSt = id => db.stations.find(s=>s.id===id)?.name||'';
      const list = db.schedules.filter(sc => (mapTrain(sc.train_id)+mapSt(sc.depart)+mapSt(sc.arrive)+sc.start+sc.end).toLowerCase().includes(q));
      const {items, pages, total} = paginate(list, page);
      const tb=$('#tblSchedules tbody'); tb.innerHTML='';
      if(!items.length){ tb.innerHTML=`<tr><td colspan="8" class="text-center text-muted">Kh√¥ng c√≥ d·ªØ li·ªáu</td></tr>`; }
      items.forEach((sc,i)=>{
        const tr=document.createElement('tr');
        tr.innerHTML = `
          <td>${(page-1)*8+i+1}</td>
          <td>${mapTrain(sc.train_id)}</td>
          <td>${mapSt(sc.depart)}</td>
          <td>${mapSt(sc.arrive)}</td>
          <td>${sc.start.replace('T',' ')}</td>
          <td>${sc.end.replace('T',' ')}</td>
          <td>${fmtMoney(sc.price)}</td>
          <td>
            <button class="btn btn-sm btn-outline-primary me-1" data-edit-schedule="${sc.id}">S·ª≠a</button>
            <button class="btn btn-sm btn-outline-danger" data-del-schedule="${sc.id}">Xo√°</button>
          </td>`;
        tb.appendChild(tr);
      });
      $('#schedulesInfo').textContent = `Hi·ªÉn th·ªã ${items.length}/${total} b·∫£n ghi`;
      renderPager($('#schedulesPager'), pages, page, i=>renderSchedules(i));
    }
    $('#filterSchedules').addEventListener('input', ()=>renderSchedules(1));
    $('#tblSchedules').addEventListener('click', (e)=>{
      const btnE=e.target.closest('[data-edit-schedule]'); const btnD=e.target.closest('[data-del-schedule]');
      if(btnE){ const id=+btnE.dataset.editSchedule; const sc=db.schedules.find(x=>x.id===id); $('#scTrain').value=sc.train_id; $('#scDepart').value=sc.depart; $('#scArrive').value=sc.arrive; $('#scStart').value=sc.start; $('#scEnd').value=sc.end; $('#scPrice').value=sc.price; $('#saveSchedule').dataset.id=id; new bootstrap.Modal('#modalSchedule').show(); }
      if(btnD){ const id=+btnD.dataset.delSchedule; if(confirmDelete()){ db.schedules=db.schedules.filter(x=>x.id!==id); renderSchedules(); showToast('ƒê√£ xo√° l·ªãch tr√¨nh','danger'); } }
    });
    $('#saveSchedule').addEventListener('click', ()=>{
      const train=+$('#scTrain').value, depart=+$('#scDepart').value, arrive=+$('#scArrive').value, start=$('#scStart').value, end=$('#scEnd').value, price=+$('#scPrice').value||0;
      if(!train||!depart||!arrive||!start||!end||price<0){ showToast('Th√¥ng tin kh√¥ng h·ª£p l·ªá','warning'); return; }
      const id=+($('#saveSchedule').dataset.id||0);
      if(id){ Object.assign(db.schedules.find(x=>x.id===id),{train_id:train,depart,arrive,start,end,price}); showToast('ƒê√£ c·∫≠p nh·∫≠t l·ªãch tr√¨nh','success'); }
      else { db.schedules.push({id:Date.now(), train_id:train, depart,arrive,start,end,price}); showToast('ƒê√£ th√™m l·ªãch tr√¨nh','success'); }
      delete $('#saveSchedule').dataset.id; bootstrap.Modal.getInstance($('#modalSchedule')).hide(); renderSchedules();
    });

    // MENUS
    function renderMenus(){
      const tb=$('#tblMenus tbody'); tb.innerHTML='';
      if(!db.menus.length){ tb.innerHTML=`<tr><td colspan="7" class="text-center text-muted">Ch∆∞a c√≥ menu</td></tr>`; }
      db.menus.sort((a,b)=>a.position-b.position).forEach((m,i)=>{
        const tr=document.createElement('tr');
        tr.innerHTML = `
          <td>${i+1}</td>
          <td><span class="badge badge-soft rounded-pill">${m.location}</span></td>
          <td>${m.label}</td>
          <td><code>${m.url}</code></td>
          <td>${m.position}</td>
          <td>${m.visible?'‚úÖ':'üö´'}</td>
          <td>
            <button class="btn btn-sm btn-outline-primary me-1" data-edit-menu="${m.id}">S·ª≠a</button>
            <button class="btn btn-sm btn-outline-danger" data-del-menu="${m.id}">Xo√°</button>
          </td>`;
        tb.appendChild(tr);
      });
    }
    $('#tblMenus').addEventListener('click', (e)=>{
      const btnE=e.target.closest('[data-edit-menu]'); const btnD=e.target.closest('[data-del-menu]');
      if(btnE){ const id=+btnE.dataset.editMenu; const m=db.menus.find(x=>x.id===id); $('#mnLoc').value=m.location; $('#mnLabel').value=m.label; $('#mnUrl').value=m.url; $('#mnPos').value=m.position; $('#mnShow').checked=m.visible; $('#saveMenu').dataset.id=id; new bootstrap.Modal('#modalMenu').show(); }
      if(btnD){ const id=+btnD.dataset.delMenu; if(confirmDelete()){ db.menus=db.menus.filter(x=>x.id!==id); renderMenus(); showToast('ƒê√£ xo√° menu','danger'); } }
    });
    $('#saveMenu').addEventListener('click', ()=>{
      const location=$('#mnLoc').value, label=$('#mnLabel').value.trim(), url=$('#mnUrl').value.trim(), position=+$('#mnPos').value||0, visible=$('#mnShow').checked;
      if(!label||!url){ showToast('Vui l√≤ng nh·∫≠p nh√£n & URL','warning'); return; }
      const id=+($('#saveMenu').dataset.id||0);
      if(id){ Object.assign(db.menus.find(x=>x.id===id),{location,label,url,position,visible}); showToast('ƒê√£ c·∫≠p nh·∫≠t menu','success'); }
      else { db.menus.push({id:Date.now(), location,label,url,position,visible}); showToast('ƒê√£ th√™m menu','success'); }
      delete $('#saveMenu').dataset.id; bootstrap.Modal.getInstance($('#modalMenu')).hide(); renderMenus();
    });

    // BOOKINGS
    function renderBookings(){
      const q = ($('#filterBookings').value||'').toLowerCase();
      const tb=$('#tblBookings tbody'); tb.innerHTML='';
      const rows = db.bookings.filter(b => (b.code+b.customer+b.line+b.start+b.status).toLowerCase().includes(q));
      if(!rows.length){ tb.innerHTML=`<tr><td colspan="7" class="text-center text-muted">Kh√¥ng c√≥ ƒë∆°n</td></tr>`; return; }
      rows.forEach(b=>{
        const tr=document.createElement('tr');
        tr.innerHTML = `
          <td><code>${b.code}</code></td>
          <td>${b.customer}</td>
          <td>${b.line}</td>
          <td>${b.start}</td>
          <td>${b.qty}</td>
          <td>${fmtMoney(b.total)}</td>
          <td><span class="badge ${b.status==='paid'?'bg-success':(b.status==='pending'?'bg-warning':'bg-secondary')}">${b.status}</span></td>`;
        tb.appendChild(tr);
      });
    }
    $('#filterBookings').addEventListener('input', renderBookings);
    $('#btnExport').addEventListener('click', ()=>{
      const header=['code','customer','line','start','qty','total','status'];
      const rows = db.bookings.map(b=> [b.code,b.customer,b.line,b.start,b.qty,b.total,b.status].join(','));
      const csv = [header.join(','), ...rows].join('\n');
      const blob = new Blob([csv],{type:'text/csv;charset=utf-8;'}); const url=URL.createObjectURL(blob);
      const a=document.createElement('a'); a.href=url; a.download='bookings.csv'; a.click(); URL.revokeObjectURL(url);
    });

    // REPORTS
    function renderReports(){
      const from = new Date(); from.setDate(from.getDate()-6);
      $('#fromDate').value = from.toISOString().slice(0,10);
      $('#toDate').value = new Date().toISOString().slice(0,10);

      const revenue = db.bookings.filter(b=>b.status==='paid').reduce((s,b)=>s+b.total,0);
      const orders = db.bookings.length;
      const paid   = db.bookings.filter(b=>b.status==='paid').length;
      const canceled = db.bookings.filter(b=>b.status==='canceled').length;
      $('#rpRevenue').textContent = fmtMoney(revenue);
      $('#rpOrders').textContent  = orders;
      $('#rpPaid').textContent    = paid;
      $('#rpCanceled').textContent= canceled;

      const ctx = document.getElementById('chartReport');
      const labels = Array.from({length:7}).map((_,i)=>{ const d=new Date(); d.setDate(d.getDate()-6+i); return d.toISOString().slice(0,10); });
      const data   = labels.map(()=> Math.round(Math.random()*2_000_000));
      new Chart(ctx,{type:'bar', data:{labels, datasets:[{label:'Revenue (demo)', data}]}, options:{responsive:true, scales:{y:{beginAtZero:true}}}});

      $('#btnFilter').onclick = ()=> showToast('Prototype: khi n·ªëi backend, b·ªô l·ªçc s·∫Ω g·ª≠i kho·∫£ng ng√†y l√™n API ƒë·ªÉ t√≠nh l·∫°i','primary');
    }

    // ===== INIT =====
    renderDashboard(); // initial
    showSection(location.hash.slice(1)||'dashboard');
  </script>
</body>
</html>
